SELECT

	SUB1.DATA,

	SUM(SUB1.VALOR_RECEBIDO) AS VALOR_RECEBIDO,

	SUM(SUB1.VALOR_GASTO) AS VALOR_PAGO

FROM(

	SELECT 

		SUB.DATA,

		CASE

			WHEN SUB.INFO = 'REC' THEN SUB.VALOR

		END AS VALOR_RECEBIDO,

		CASE

			WHEN SUB.INFO = 'PAG' THEN SUB.VALOR

		END AS VALOR_GASTO

	FROM (

		SELECT

			'REC' AS INFO,

			SUBSTRING(CONVERT(VARCHAR(10),rdi.DATREC,103),4,7) AS DATA,

			rdi.VLRREC AS VALOR

		FROM

			RECDOCI rdi

		WHERE

			DATEADD(MONTH,0,rdi.DATREC) >= DATEADD(MONTH,-12,GETDATE()) AND

			rdi.DATREC <= GETDATE()

		UNION ALL

		SELECT

			'PAG' AS INFO,

			SUBSTRING(CONVERT(VARCHAR(10),pdi.DATPAG,103),4,7) AS DATA,

			pdi.VLRPAG AS VALOR

		FROM
			
			PAGDOCI pdi

		WHERE

			DATEADD(MONTH,0,pdi.DATPAG) >= DATEADD(MONTH,-12,GETDATE()) AND

			pdi.DATPAG <= GETDATE()

	) AS SUB

)AS SUB1

GROUP BY SUB1.DATA

ORDER BY SUBSTRING(SUB1.DATA,7,4),SUBSTRING(SUB1.DATA,1,2)